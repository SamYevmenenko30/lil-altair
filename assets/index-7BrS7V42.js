(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();const Y=()=>{const t=new URLSearchParams(window.location.search).get("q");if(!t)throw new Error("No query id provided!");location.replace(`altair://share?q=${encodeURIComponent(t)}`)},J="altairgql:oauth:callback:response",T=["chrome-extension://flnheeellpciglgpaodhkhmapeljopja","chrome-extension://aiopipphfnlndegenpkclffgaiillbdd","moz-extension://567d7e27-43b8-994e-ab50-e770fa7eab4b","http://localhost:4200","https://dash.altairgraphql.dev","https://altair-gql.sirmuel.design","https://web.altairgraphql.dev","altair://-"],h=()=>{try{console.log("Closing window"),K(),window.close()}catch{}},K=()=>{sessionStorage.clear()},w=()=>{const t=new URLSearchParams(window.location.search).get("sc");if(!t)return;const e=new URL(t);if(T.includes(e.origin))return e.origin},_=i=>!!i,E=(i,t)=>{const e=t??w();if(!e)throw new Error("No opener found");return window.opener.postMessage(i,e)},V=i=>{window.addEventListener("message",t=>{_(window.opener)&&T.map(e=>new URL(e).origin).includes(t.origin)&&i(t)})},d=window.chrome||window.browser;var I;const $=!!((I=d==null?void 0:d.runtime)!=null&&I.id);var f;(function(i){i.AUTO="auto",i.CONCATENATE="concatenate",i.APPEND="append",i.PATCH="patch"})(f||(f={}));const m="http",W="websocket",A=!!(window&&window.process&&window.process.versions.electron||window.navigator.userAgent.match(/Electron/)),S={development:{api:"http://localhost:3000",loginClient:"http://localhost:1234",sandbox:"http://localhost:5123",docs:"http://localhost:6025"},production:{api:"https://api.altairgraphql.dev",loginClient:"https://redir.altairgraphql.dev",sandbox:"https://sandbox.altairgraphql.dev",docs:"https://altairgraphql.dev"},testing:{api:"http://localhost:3000",loginClient:"http://localhost:1234",sandbox:"http://localhost:5123",docs:"http://localhost:6025"}},R=window.__ALTAIR_TRANSLATE__,Z=i=>{try{return new URL(i)}catch{return}};class Q{constructor({endpointURL:t,subscriptionsEndpoint:e,subscriptionsProtocol:o,initialQuery:n,initialHeaders:s,initialEnvironments:c,initialVariables:L,initialPreRequestScript:O,initialPostRequestScript:N="",instanceStorageNamespace:P,initialSettings:D,persistedSettings:q,initialRequestHandlerId:v=m,initialRequestHandlerAdditionalParams:k={},initialSubscriptionRequestHandlerId:x=W,initialSubscriptionsPayload:H={},initialHttpMethod:B="POST",preserveState:z=!0,initialWindows:M=[],disableAccount:j=!1,initialAuthorization:F,cspNonce:G=""}={}){this.useLocalSandboxUrl=!1,this.donation={url:"https://opencollective.com/altair/donate",action_count_threshold:50},this.ga="UA-41432833-6",this.add_query_depth_limit=3,this.tab_size=2,this.max_windows=A?50:15,this.default_language=R?"ach-UG":"en-US",this.languages={"en-US":"English","fr-FR":"French","es-ES":"EspaÃ±ol","cs-CZ":"Czech","de-DE":"German","pt-BR":"Brazilian","ru-RU":"Russian","uk-UA":"Ukrainian","zh-CN":"Chinese Simplified","ja-JP":"Japanese","sr-SP":"Serbian","it-IT":"Italian","pl-PL":"Polish","ko-KR":"Korean","ro-RO":"Romanian","vi-VN":"Vietnamese"},this.query_history_depth=A?100:15,this.disableLineNumbers=!1,this.defaultTheme="system",this.themes=["light","dark","dracula","system"],this.isTranslateMode=R,this.isWebApp=window.__ALTAIR_WEB_APP__,this.cspNonce="",this.initialData={url:"",subscriptionsEndpoint:"",subscriptionsProtocol:"",query:"",variables:"",headers:null,environments:{},preRequestScript:"",postRequestScript:"",instanceStorageNamespace:"altair_",settings:void 0,persistedSettings:void 0,initialSubscriptionRequestHandlerId:void 0,initialSubscriptionsPayload:{},initialRequestHandlerId:m,initialRequestHandlerAdditionalParams:{},initialHttpMethod:"POST",preserveState:!0,windows:[],disableAccount:!1,initialAuthorization:void 0},this.cspNonce=G,this.initialData.url=window.__ALTAIR_ENDPOINT_URL__??t??"",this.initialData.subscriptionsEndpoint=window.__ALTAIR_SUBSCRIPTIONS_ENDPOINT__??e??"",this.initialData.subscriptionsProtocol=o??"",this.initialData.query=window.__ALTAIR_INITIAL_QUERY__??n??"",this.initialData.variables=window.__ALTAIR_INITIAL_VARIABLES__??L??"",this.initialData.headers=window.__ALTAIR_INITIAL_HEADERS__??s??"",this.initialData.environments=c??{},this.initialData.preRequestScript=window.__ALTAIR_INITIAL_PRE_REQUEST_SCRIPT__??O??"",this.initialData.postRequestScript=N,this.initialData.instanceStorageNamespace=window.__ALTAIR_INSTANCE_STORAGE_NAMESPACE__??P??"altair_",this.initialData.settings=D,this.initialData.persistedSettings=q,this.initialData.initialSubscriptionRequestHandlerId=x,this.initialData.initialSubscriptionsPayload=H,this.initialData.initialRequestHandlerId=v,this.initialData.initialRequestHandlerAdditionalParams=k,this.initialData.initialHttpMethod=B,this.initialData.preserveState=z,this.initialData.windows=M,this.initialData.disableAccount=j,this.initialData.initialAuthorization=F}getPossibleLocalSandBoxRoot(){var t;if(!$&&document.baseURI&&((t=Z(document.baseURI))==null?void 0:t.origin)===window.location.origin)return document.baseURI.endsWith("/")?new URL(document.baseURI+"iframe-sandbox"):new URL(document.baseURI.slice(0,document.baseURI.lastIndexOf("/")+1)+"iframe-sandbox")}async getLocalSandBoxUrl(){var t;if(typeof this.localSandboxUrl>"u"){const e=((t=this.getPossibleLocalSandBoxRoot())==null?void 0:t.href)??"";if(e){this.localSandboxUrl=e+"/index.html";const o=e+"/sandbox.png";(await fetch(o)).ok&&(this.useLocalSandboxUrl=!0)}}if(this.useLocalSandboxUrl)return this.localSandboxUrl}getUrlConfig(t="production"){return S[t]}async getUrlConfigWithLocal(t="production"){const e=await this.getLocalSandBoxUrl(),o=S[t];return e&&(o.sandbox=e),o}async getUrl(t,e="production"){return(await this.getUrlConfigWithLocal(e))[t]}}let X=new Q;const b=()=>X;window.getAltairConfig=b;const tt={GOOGLE:"GOOGLE",GITHUB:"GITHUB"},g="altairgql:oauth:nonce:key",U=()=>new URLSearchParams(window.location.search).get("nonce"),et=()=>{sessionStorage.removeItem(g)},it=i=>{const t=sessionStorage.getItem(g);return!t||!i?!1:t===i},ot=async i=>{const t=U();if(!it(t))throw new Error("nonce does not match!");const e={token:i,nonce:t};if(_(window.opener)){const o=w();if(!o)throw new Error("Invalid source provided!");window.opener.postMessage({type:J,payload:e},o);return}await fetch("/callback",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})},nt=()=>{const t=new URLSearchParams(location.search).get("access_token");if(t)return{accessToken:t}},st=()=>new URLSearchParams(window.location.search).get("provider")||tt.GOOGLE,at=(i,t)=>{const e=location.href,o=new URL(`/auth/${t.toLowerCase()}/login`,i);return o.searchParams.append("state",e),location.replace(o.href)},rt=async()=>{const i=b().getUrlConfig("production"),t=nt();if(!t){const e=U();if(!e)throw new Error("No nonce found!");sessionStorage.setItem(g,e);const o=st();return at(i.api,o)}await ot(t.accessToken),et(),document.body.innerText="You can now close this window.",h()},ct=i=>{const t=new TextEncoder().encode(i),e=Array.from(t,o=>String.fromCodePoint(o)).join("");return btoa(e)},lt=i=>btoa(Array.from(new Uint8Array(i),t=>String.fromCharCode(t)).join("")).replace(/\+/g,"-").replace(/\//g,"_").replace(/={1,4}$/,""),dt=async i=>{const t=new TextEncoder().encode(i);return await window.crypto.subtle.digest("SHA-256",t)},ht=async i=>lt(await dt(i));var a;(function(i){i.AUTHORIZATION_CODE="auth_code",i.AUTHORIZATION_CODE_PKCE="auth_code_pkce",i.CLIENT_CREDENTIALS="client_credentials"})(a||(a={}));var l;(function(i){i.BASIC_AUTH="basic",i.IN_BODY="body"})(l||(l={}));var r;(function(i){i.JSON="json",i.FORM="form"})(r||(r={}));class y{constructor(t){this.options=t}async getAuthorizationUrl(){if(this.options.type===a.CLIENT_CREDENTIALS)throw new Error("Client Credentials flow not supported for authorization code");const t={response_type:"code",client_id:this.options.clientId,redirect_uri:this.options.redirectUri,state:this.options.state,scope:this.options.scopes.join(" "),...this.options.type==="auth_code_pkce"?{code_challenge:await ht(this.options.codeVerifier),code_challenge_method:"S256"}:{}},e=new URLSearchParams(t),o=new URL(this.options.authorizationEndpoint);return new URL(`${o.origin}${o.pathname}?${e.toString()}`).toString()}async getAuthorizationRedirectResponse(){if(this.options.type===a.CLIENT_CREDENTIALS)throw new Error("Client Credentials flow not supported for authorization code");const t=new URL(window.location.href),e=Object.fromEntries(t.searchParams.entries());if(e.error)return{error:e.error,state:e.state??"",error_description:e.error_description,error_uri:e.error_uri};if(!(!e.code||!e.state))return e.state!==this.options.state?{error:"invalid_state",state:e.state,error_description:"The state is invalid"}:{code:e.code,state:e.state}}async getAccessTokenFromCode(t){if(this.options.type===a.CLIENT_CREDENTIALS)throw new Error("Client Credentials flow not supported");const e={grant_type:"authorization_code",code:t,redirect_uri:this.options.redirectUri,client_id:this.options.clientId,client_secret:this.options.clientSecret,...this.options.type==="auth_code_pkce"?{code_verifier:this.options.codeVerifier}:{}};return this.makeAccessTokenRequest(e)}async getAccessTokenFromClientCredentials(){if(this.options.type!==a.CLIENT_CREDENTIALS)throw new Error("Only Client Credentials flow is supported");const t={grant_type:"client_credentials",client_id:this.options.clientId,client_secret:this.options.clientSecret,scope:this.options.scopes.join(" ")};return this.makeAccessTokenRequest(t)}getAccessTokenRequestHeaders(){const t={};switch(this.options.authFormat){case l.BASIC_AUTH:{t.Authorization=`Basic ${ct(`${this.options.clientId}:${this.options.clientSecret}`)}`;break}}switch(this.options.requestFormat){case r.JSON:{t.Accept="application/json",t["Content-Type"]="application/json";break}case r.FORM:{t["Content-Type"]="application/x-www-form-urlencoded";break}}return t}getAccessTokenRequestBody(t){let e=structuredClone(t);switch(this.options.authFormat){case l.BASIC_AUTH:{const{client_id:o,client_secret:n,...s}=t;e=s;break}}switch(this.options.requestFormat){case r.JSON:return JSON.stringify(e);case r.FORM:return new URLSearchParams({...e}).toString()}}async makeAccessTokenRequest(t){return await(await fetch(this.options.tokenEndpoint,{method:"POST",headers:this.getAccessTokenRequestHeaders(),body:this.getAccessTokenRequestBody(t)})).json()}}const p={FRAME_READY:"frame-ready",ACTION:"action",AUTHORIZATION_CODE:"authorization-code"},C="altairgql:oauth2:client_options",u="altairgql:oauth:source",pt=async()=>{if(await ut())return;const i=w();i&&sessionStorage.setItem(u,i),V(async t=>{const{type:e,payload:o}=t.data;if(e!==p.ACTION)return;sessionStorage.setItem(C,JSON.stringify(o));const s=await new y(o).getAuthorizationUrl();location.replace(s)}),E({type:p.FRAME_READY},sessionStorage.getItem(u)??void 0)},ut=async()=>{const i=sessionStorage.getItem(C);if(!i)return;const e=await new y(JSON.parse(i)).getAuthorizationRedirectResponse();if(e)return _(window.opener)?(E({type:p.AUTHORIZATION_CODE,payload:e},sessionStorage.getItem(u)??void 0),h(),!0):(h(),!0)},wt=async()=>{switch(new URLSearchParams(window.location.search).get("action")??window.location.pathname.split("/")[1]){case"share":Y();break;case"oauth2":await pt();break;default:await rt();break}};wt();
