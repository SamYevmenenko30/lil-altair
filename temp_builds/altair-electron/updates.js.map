{"version":3,"file":"updates.js","sources":["updates.ts"],"sourceRoot":"/","sourcesContent":["import fs from 'fs';\nimport { app, dialog, MenuItem } from 'electron';\n\nimport { autoUpdater } from 'electron-updater';\nimport log from 'electron-log';\n\n// const server = 'https://hazel-server-gufzwmrois.now.sh';\n// const feed = `${server}/update/${process.platform}/${app.getVersion()}`;\n\n// const CHECK_UPDATE_INTERVAL = 1000 * 60 * 15; // every 15 mins\n\nlet updater: MenuItem | undefined;\nlet isSilentCheck = true;\nautoUpdater.autoDownload = false;\n\nautoUpdater.on('error', (error) => {\n  dialog.showErrorBox(\n    'Error: ',\n    !!error === null ? 'unknown' : (error.stack || error).toString()\n  );\n});\n\nautoUpdater.on('update-not-available', () => {\n  if (!isSilentCheck) {\n    dialog.showMessageBox({\n      title: 'No Updates',\n      message: 'Current version is up-to-date.',\n    });\n  }\n  if (updater) {\n    updater.enabled = true;\n    updater = undefined;\n  }\n});\n\nautoUpdater.on('update-downloaded', () => {\n  dialog\n    .showMessageBox({\n      title: 'Install Updates',\n      message: 'Updates downloaded, application will now exit to update.',\n    })\n    .then(() => {\n      setImmediate(() => autoUpdater.quitAndInstall());\n    });\n});\n\nconst canUpdate = () => {\n  // app.isPackaged does not work well (see #2114)\n  // TODO: Figure out how to resolve the protected app access error\n  const _au: any = autoUpdater;\n  // Don't check for updates if update config is not found (auto-update via electron is not supported)\n  return (\n    _au.app &&\n    _au.app.appUpdateConfigPath &&\n    fs.existsSync(_au.app.appUpdateConfigPath)\n  );\n};\n\nexport const setupAutoUpdates = () => {\n  if (!canUpdate()) {\n    return;\n  }\n\n  log.transports.file.level = 'info';\n  autoUpdater.logger = log;\n  // autoUpdater.checkForUpdatesAndNotify();\n  autoUpdater.checkForUpdates().catch((err) => console.error(err));\n};\n\n// autoUpdater.on('update-downloaded', (event, releaseNotes, releaseName) => {\n//   const dialogOpts = {\n//     type: 'info',\n//     buttons: ['Restart', 'Later'],\n//     title: 'Install Updates',\n//     message: process.platform === 'win32' ? releaseNotes : releaseName,\n//     detail: 'A new version has been downloaded. Restart the application to apply the updates.'\n//   };\n\n//   dialog.showMessageBox(dialogOpts, (response) => {\n//     if (response === 0) {\n//       autoUpdater.quitAndInstall();\n//     }\n//   });\n// });\n\nexport const checkForUpdates = (menuItem: MenuItem) => {\n  if (!canUpdate()) {\n    return;\n  }\n\n  if (menuItem) {\n    updater = menuItem;\n    updater.enabled = false;\n  }\n  isSilentCheck = false;\n  autoUpdater.checkForUpdates().catch((err) => console.error(err));\n};\n"],"names":[],"mappings":"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","debug_id":"ac9f2f64-27fb-56da-9c06-3f106ed80039"}