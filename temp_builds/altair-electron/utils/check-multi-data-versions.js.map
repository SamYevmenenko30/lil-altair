{"version":3,"file":"check-multi-data-versions.js","sources":["utils/check-multi-data-versions.ts"],"sourceRoot":"/","sourcesContent":["import { app, BrowserWindow, dialog } from 'electron';\nimport { resolve } from 'path';\nimport { renameSync } from 'fs';\nimport { getDirectoriesInDirectory, deleteFolderRecursive } from './index';\n\nconst getUserDataParentPath = () => resolve(app.getPath('userData'), '..');\n\nconst DIR_2_3_7 = 'altair';\nconst DIR_2_3_6 = 'altair-electron';\nconst DIR_ALL = 'Altair GraphQL Client';\nconst userDataVersions = [\n  DIR_2_3_6, // v2.3.6\n  DIR_2_3_7, // v2.3.7\n  DIR_ALL, // all others\n];\n\nexport const checkMultipleDataVersions = (win: BrowserWindow) => {\n  getDirectoriesInDirectory(getUserDataParentPath()).then(\n    async (directories) => {\n      const foundVersions = directories.filter((dir) =>\n        userDataVersions.includes(dir)\n      );\n\n      if (foundVersions.length > 1) {\n        console.log(foundVersions);\n        const response = await dialog.showMessageBox(win, {\n          type: 'info',\n          buttons: [\n            'This is the correct version',\n            'Clear this version',\n            'Remind me later',\n          ],\n          defaultId: 0,\n          cancelId: 2,\n          title: 'Multiple versions found',\n          message: 'We found multiple versions of your Altair data',\n          detail: `Due to some misconfiguration that happened in some of the recent versions of Altair, there are several versions of your data. We want to help you keep the right data.\\n\\nTo do that, check if the current data is correct, and we will clear out the rest.\\n\\nTip: You can click the 'Remind me later' and we'll ask again when you restart.`,\n        });\n\n        switch (response.response) {\n          case 0: // Correct version\n            // Clear other data\n            foundVersions\n              .filter((v) => v !== DIR_ALL)\n              .forEach((version) => {\n                console.log('removing version', version);\n                // Delete DIR_2_3_6 and DIR_2_3_7\n                deleteFolderRecursive(\n                  resolve(getUserDataParentPath(), version)\n                );\n              });\n            app.relaunch();\n            app.exit(0);\n            return;\n          case 1: // clear THIS version\n            // Clear THIS data\n            const nextVersion = foundVersions.find((v) => v !== DIR_ALL);\n            if (nextVersion) {\n              console.log('next version', nextVersion);\n              // Delete DIR_ALL\n              deleteFolderRecursive(resolve(getUserDataParentPath(), DIR_ALL));\n              // Move the next version (DIR_2_3_6 or DIR_2_3_7) to DIR_ALL\n              renameSync(\n                resolve(getUserDataParentPath(), nextVersion),\n                resolve(getUserDataParentPath(), DIR_ALL)\n              );\n              app.relaunch();\n              app.exit(0);\n            }\n            return;\n          default:\n            // do nothing\n            console.log('Doing nothing.');\n        }\n      }\n    }\n  );\n};\n"],"names":[],"mappings":"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","debug_id":"00dab832-7692-5b31-9d93-07c59434abc1"}